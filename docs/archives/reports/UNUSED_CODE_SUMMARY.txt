================================================================================
UNUSED CODE ANALYSIS - EXECUTIVE SUMMARY
================================================================================
Project: layra
Date: 2026-01-28
Files Analyzed: 364 Python + TypeScript files
================================================================================

TOTAL UNUSED CODE DETECTED: 449 items
├── Python: 443 items
└── TypeScript: 6 items

================================================================================
CATEGORIZATION BY RISK LEVEL
================================================================================

SAFE TO DELETE (Immediate Action) ──────────────────────────────────────
  Items: 248 (~945 lines)
  
  ✓ 2 entire files:
    - backend/app/db/cache.py (236 lines, 16 unused functions)
    - backend/app/db/repositories/base_repository.py (180 lines)
  
  ✓ 21 unused functions:
    - 5 circuit breaker functions (circuit_breaker.py)
    - 2 typo functions named "re_name"
    - 16 cache functions (in cache.py)
  
  ✓ 221 unused imports:
    - Type hints (Any, Dict, List, Union, Optional, Tuple)
    - Unused modules (os, logging, enum, concurrent.futures, etc.)
  
  ✓ 4 commented code blocks:
    - Frontend hardcoded IP addresses
    - Frontend incomplete features
    - Backend outdated deployment code

NEEDS VERIFICATION (Medium Risk) ───────────────────────────────────────
  Items: 7 (~150 lines)
  
  ? Workflow component exports:
    - MAX_CONTEXT_SIZE, PROVIDER_TIMEOUTS, etc.
    - WorkflowCheckpointManager, LLMClient
    - May be used via dynamic imports
  
  ? Test file references:
    - 7 deleted repository classes referenced in tests
    - Need to update tests OR restore repositories

KEEP (Technical Debt & Documentation) ───────────────────────────────────
  Items: 194 (~1,687 lines)
  
  ℹ Documentation comments:
    - 10 TODO/NOTE comments explaining behavior
    - Migration template comments (Alembic boilerplate)
    - Performance optimization notes (torch.compile)
  
  ℹ Technical debt:
    - MongoDB file: 1,566 lines needs refactoring
    - gpt-4o-mini deprecation (Feb 2026)

================================================================================
DELETION RECOMMENDATIONS
================================================================================

PHASE 1: Safe Deletions (Immediate) ───────────────────────────────────
  
  1. Delete unused files:
     $ rm backend/app/db/cache.py
     $ rm backend/app/db/repositories/base_repository.py
  
  2. Remove unused imports:
     $ cd backend
     $ autoflake --remove-all-unused-imports --in-place --recursive app
  
  3. Remove unused functions (manual edit):
     - backend/app/core/circuit_breaker.py (5 functions)
     - backend/app/api/endpoints/chat.py (re_name)
     - backend/app/api/endpoints/base.py (re_name)
  
  4. Remove commented code:
     - frontend/src/app/[locale]/ai-chat/page.tsx (line 357)
     - frontend/src/components/AiChat/LeftSidebar.tsx (line 102)
     - frontend/src/utils/imageLoader.ts (line 25)
     - scripts/archive/download_models.py (lines 63-66)

PHASE 2: Verification Required ─────────────────────────────────────────
  
  1. Search workflow component usage:
     $ rg "MAX_CONTEXT_SIZE|WorkflowCheckpointManager" backend/app
  
  2. Update test files:
     - Remove references to deleted repositories
     - OR restore repository pattern if needed
  
  3. Verify before deleting:
     - Any endpoint functions (they're HTTP routes, not unused)

PHASE 3: Technical Debt ────────────────────────────────────────────────
  
  1. Create MongoDB refactoring task:
     - Split 1,566-line mongo.py into repositories
  
  2. Add calendar reminder:
     - gpt-4o-mini deprecation: February 27, 2026

================================================================================
IMPACT METRICS
================================================================================

Code Reduction Potential:
┌─────────────────────┬───────┬───────┬─────────┐
│ Category            │ Items │ Lines │ Risk    │
├─────────────────────┼───────┼───────┼─────────┤
│ Unused Imports      │   221 │   221 │ Safe    │
│ Unused Functions    │    21 │   300 │ Safe    │
│ Unused Files        │     2 │   416 │ Safe    │
│ Commented Code      │     4 │     8 │ Safe    │
├─────────────────────┼───────┼───────┼─────────┤
│ TOTAL SAFE          │   248 │   945 │ Safe    │
│ Needs Verification  │     7 │   150 │ Medium  │
│ Technical Debt      │     2 │ 1,566 │ Low     │
└─────────────────────┴───────┴───────┴─────────┘

Benefits:
• Reduced cognitive load: ~945 lines less code to maintain
• Faster imports: 221 fewer imports to process
• Clearer codebase: Remove ambiguity around unused functions
• Better maintainability: Delete what's not used

================================================================================
TESTING STRATEGY
================================================================================

Before Deletion:
────────────────────────────────────────────────────────────────────────────
$ cd backend
$ python -m pytest tests/ -v
$ python -c "from app.api.endpoints import auth, chat, workflow; print('OK')"

$ cd ../frontend
$ npm run build

After Deletion:
────────────────────────────────────────────────────────────────────────────
$ cd backend
$ python -m py_compile app/db/*.py
$ python -m pytest tests/ -v

Integration Test:
────────────────────────────────────────────────────────────────────────────
$ docker-compose up --build
# Test API endpoints
# Verify no import errors

================================================================================
CRITICAL CORRECTIONS
================================================================================

NOT UNUSED (False Positives):
────────────────────────────────────────────────────────────────────────────
✗ Auth endpoint functions (verify_token, login, register, logout)
  WHY: These are FastAPI route handlers used via HTTP, not direct calls
  STATUS: KEEP ALL - API endpoints are used by frontend

✗ Workflow component exports
  WHY: May be used via dynamic imports or __all__
  STATUS: KEEP - Manual review required

✗ Documentation comments (TODO/NOTE)
  WHY: Explain important behavior and technical debt
  STATUS: KEEP - Valuable context for developers

================================================================================
KEY FINDINGS
================================================================================

1. Largest Unused File: backend/app/db/cache.py
   - 236 lines, 16 functions, ZERO usages
   - Entire Redis caching layer not implemented
   - Safe to delete entirely

2. Most Common Unused Items: Type hints (Any, Dict, List)
   - 221 unused imports across codebase
   - Safe to remove with autoflake

3. Biggest Technical Debt: backend/app/db/mongo.py
   - 1,566 lines in single file
   - TODO comment: "needs to be split into repositories"
   - Create refactoring task for next sprint

4. Deleted Repository Pattern:
   - 7 repository files deleted (git status)
   - Test files still reference them
   - Update tests OR restore pattern

================================================================================
NEXT STEPS
================================================================================

Immediate (This Sprint):
  1. Delete cache.py and base_repository.py
  2. Remove 221 unused imports
  3. Delete 5 unused circuit breaker functions
  4. Remove commented hardcoded IPs

Short-term (Next Sprint):
  1. Update test files for repository references
  2. Verify workflow component exports
  3. Create MongoDB refactoring plan

Long-term (Backlog):
  1. Implement MongoDB refactoring
  2. Review gpt-4o-mini deprecation (Feb 2026)
  3. Regular unused code audits (quarterly)

================================================================================
REPORT FILES GENERATED
================================================================================

1. UNUSED_CODE_INVENTORY.md
   - Detailed inventory of all 449 unused items
   - Categorized by type and risk level
   - File locations and line numbers

2. UNUSED_CODE_QUICK_REFERENCE.md
   - Quick reference for cleanup actions
   - Command examples for deletion
   - Testing checklist

3. UNUSED_CODE_FINAL_REPORT.md (This file)
   - Executive summary
   - Impact metrics
   - Deletion recommendations

4. unused_code_analysis.json
   - Machine-readable results
   - Full analysis data
   - For automated tooling

================================================================================
CONCLUSION
================================================================================

Analysis identified 449 potentially unused code items across the codebase.
After manual verification, 248 items (~945 lines) are confirmed safe to delete:
  • 2 entire unused files
  • 21 unused functions
  • 221 unused imports
  • 4 commented code blocks

The remaining items either require verification or should be kept as
documentation/technical debt markers.

Recommended approach: Start with safe deletions, verify remaining items,
and plan technical debt work for future sprints.

================================================================================
